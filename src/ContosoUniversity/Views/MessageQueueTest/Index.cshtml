@{
    ViewBag.Title = "Message Queue Test";
}

<h2>@ViewBag.Title</h2>

@if (!string.IsNullOrEmpty(ViewBag.Message))
{
    <div class="alert alert-@(ViewBag.MessageType ?? "info")">
        @ViewBag.Message
    </div>
}

<div class="row">
    <div class="col-md-6">
        <h3>Notification Service Tests</h3>
        
        @using (Html.BeginForm("SendTestNotification", "MessageQueueTest", FormMethod.Post))
        {
            <button type="submit" class="btn btn-primary">Send Test Notification</button>
        }
        
        <br /><br />
        
        @using (Html.BeginForm("ReceiveNotifications", "MessageQueueTest", FormMethod.Post))
        {
            <button type="submit" class="btn btn-success">Receive Notifications</button>
        }
    </div>
    
    <div class="col-md-6">
        <h3>Basic Queue Tests</h3>
        
        @using (Html.BeginForm("TestBasicQueue", "MessageQueueTest", FormMethod.Post))
        {
            <button type="submit" class="btn btn-info">Test Basic Queue Operations</button>
        }
        
        <br /><br />
        
        @using (Html.BeginForm("GetQueueStatus", "MessageQueueTest", FormMethod.Post))
        {
            <button type="submit" class="btn btn-warning">Get Queue Status</button>
        }
    </div>
</div>

@if (ViewBag.Notifications != null)
{
    <h3>Received Notifications</h3>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Entity Type</th>
                    <th>Entity ID</th>
                    <th>Operation</th>
                    <th>Message</th>
                    <th>Created By</th>
                    <th>Created At</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var notification in (System.Collections.Generic.List<ContosoUniversity.Models.Notification>)ViewBag.Notifications)
                {
                    <tr>
                        <td>@notification.EntityType</td>
                        <td>@notification.EntityId</td>
                        <td>@notification.Operation</td>
                        <td>@notification.Message</td>
                        <td>@notification.CreatedBy</td>
                        <td>@notification.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<h3>Implementation Notes</h3>
<div class="well">
    <p><strong>Custom MessageQueue Implementation</strong></p>
    <ul>
        <li>This implementation uses in-memory queues that don't require MSMQ installation</li>
        <li>Queues are managed by the <code>MessageQueueManager</code> class</li>
        <li>Messages are stored in concurrent collections for thread safety</li>
        <li>The API is compatible with System.Messaging.MessageQueue</li>
        <li>Supports async operations and timeout handling</li>
        <li>No external dependencies required</li>
    </ul>
    
    <p><strong>Limitations</strong></p>
    <ul>
        <li>Messages are lost when the application restarts (in-memory only)</li>
        <li>No persistence across application domains</li>
        <li>Limited to single machine scenarios</li>
        <li>For production use, consider implementing persistence or using a proper message broker</li>
    </ul>
</div>