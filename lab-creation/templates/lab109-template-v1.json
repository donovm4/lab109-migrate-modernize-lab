{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {},
  "parameters": {
    "prefix": {
      "type": "string",
      "defaultValue": "lab@lab.LabInstance.ID",
      "metadata": {
        "description": "Resource name prefix"
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for all resources"
      }
    },
    "migrateLocation": {
      "type": "string",
      "defaultValue": "canadacentral",
      "metadata": {
        "description": "Location for Azure Migrate resources"
      }
    }
  },
  "variables": {
    "vnetName": "[format('{0}-vnet', parameters('prefix'))]",
    "vmName": "[format('{0}-vm', parameters('prefix'))]",
    "subnets": [
      {
        "name": "nat",
        "addressPrefix": "172.100.0.0/24",
        "nsgName": "nat-nsg",
        "privateIp": "172.100.0.4"
      },
      {
        "name": "hypervlan",
        "addressPrefix": "172.100.1.0/24",
        "nsgName": "hyperv-nsg",
        "privateIp": "172.100.1.4"
      },
      {
        "name": "ghosted",
        "addressPrefix": "172.100.2.0/24",
        "nsgName": "ghosted-nsg",
        "privateIp": ""
      },
      {
        "name": "azurevms",
        "addressPrefix": "172.100.3.0/24",
        "nsgName": "azurevms-nsg",
        "privateIp": ""
      }
    ],
    "nsgRules": {
      "nat-nsg": [
        {
          "name": "RDP",
          "priority": 100,
          "direction": "Inbound",
          "access": "Allow",
          "protocol": "Tcp",
          "sourcePortRange": "*",
          "destinationPortRange": "3389",
          "sourceAddressPrefix": "*",
          "destinationAddressPrefix": "172.100.0.4"
        }
      ],
      "hyperv-nsg": [
        {
          "name": "RDP",
          "priority": 100,
          "direction": "Inbound",
          "access": "Allow",
          "protocol": "Tcp",
          "sourcePortRange": "*",
          "destinationPortRange": "3389",
          "sourceAddressPrefix": "*",
          "destinationAddressPrefix": "172.100.1.4"
        }
      ],
      "ghosted-nsg": [],
      "azurevms-nsg": []
    },
    "globalTags": {
      "AZM-LAB": "1221-AZM-LAB-AR10-8501D10S744",
      "TemplateVersion": "6.0.0"
    }
  },
  "resources": [
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "name": "deploy-azure-migrate",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "prefix": {
            "value": "[parameters('prefix')]"
          },
          "migrateLocation": {
            "value": "[parameters('migrateLocation')]"
          },
          "tags": {
            "value": "[variables('globalTags')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "parameters": {
            "prefix": {
              "type": "string",
              "metadata": {
                "description": "Resource name prefix"
              }
            },
            "migrateLocation": {
              "type": "string",
              "metadata": {
                "description": "Location for Azure Migrate resources"
              }
            },
            "tags": {
              "type": "object",
              "defaultValue": {},
              "metadata": {
                "description": "Tags to apply to Azure Migrate resources"
              }
            }
          },
          "variables": {
            "location": "[resourceGroup().location]",
            "projectName": "[format('{0}-prj', parameters('prefix'))]",
            "migrateProjectName": "[format('{0}-azm', parameters('prefix'))]",
            "applianceName": "[format('{0}-offlinecollector', parameters('prefix'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Migrate/MigrateProjects",
              "apiVersion": "2020-06-01-preview",
              "name": "[variables('migrateProjectName')]",
              "location": "[parameters('migrateLocation')]",
              "tags": "[union(parameters('tags'), createObject('Migrate Project', variables('migrateProjectName')))]",
              "properties": {}
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "deploy-migrate-solutions",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "prefix": {
                    "value": "[parameters('prefix')]"
                  },
                  "migrateLocation": {
                    "value": "[parameters('migrateLocation')]"
                  },
                  "tags": {
                    "value": "[parameters('tags')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "prefix": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource name prefix"
                      }
                    },
                    "migrateLocation": {
                      "type": "string",
                      "metadata": {
                        "description": "Location for Azure Migrate resources"
                      }
                    },
                    "tags": {
                      "type": "object",
                      "defaultValue": {},
                      "metadata": {
                        "description": "Tags to apply to the resources"
                      }
                    }
                  },
                  "variables": {
                    "migrateProjectName": "[format('{0}-azm', parameters('prefix'))]"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Migrate/MigrateProjects/Solutions",
                      "apiVersion": "2020-06-01-preview",
                      "name": "[format('{0}/{1}', variables('migrateProjectName'), 'Servers-Assessment-ServerAssessment')]",
                      "tags": "[parameters('tags')]",
                      "properties": {
                        "tool": "ServerAssessment",
                        "purpose": "Assessment",
                        "goal": "Servers",
                        "status": "Active",
                        "details": null
                      }
                    },
                    {
                      "type": "Microsoft.Migrate/MigrateProjects/Solutions",
                      "apiVersion": "2020-06-01-preview",
                      "name": "[format('{0}/{1}', variables('migrateProjectName'), 'Servers-Discovery-ServerDiscovery')]",
                      "tags": "[parameters('tags')]",
                      "properties": {
                        "tool": "ServerDiscovery",
                        "purpose": "Discovery",
                        "goal": "Servers",
                        "status": "Inactive",
                        "details": null
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', variables('migrateProjectName'), 'Servers-Assessment-ServerAssessment')]"
                      ]
                    },
                    {
                      "type": "Microsoft.Migrate/MigrateProjects/Solutions",
                      "apiVersion": "2020-06-01-preview",
                      "name": "[format('{0}/{1}', variables('migrateProjectName'), 'Servers-Migration-ServerMigration')]",
                      "tags": "[parameters('tags')]",
                      "properties": {
                        "tool": "ServerMigration",
                        "purpose": "Migration",
                        "goal": "Servers",
                        "status": "Active",
                        "details": null
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', variables('migrateProjectName'), 'Servers-Discovery-ServerDiscovery')]"
                      ]
                    },
                    {
                      "type": "Microsoft.Migrate/MigrateProjects/Solutions",
                      "apiVersion": "2020-06-01-preview",
                      "name": "[format('{0}/{1}', variables('migrateProjectName'), 'Servers-Migration-ServerMigration_DataReplication')]",
                      "tags": "[parameters('tags')]",
                      "properties": {
                        "tool": "ServerMigration_DataReplication",
                        "purpose": "Migration",
                        "goal": "Servers",
                        "status": "Inactive",
                        "details": null
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', variables('migrateProjectName'), 'Servers-Migration-ServerMigration')]"
                      ]
                    }
                  ],
                  "outputs": {
                    "serverAssessmentSolutionId": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', variables('migrateProjectName'), 'Servers-Assessment-ServerAssessment')]"
                    },
                    "serverDiscoverySolutionId": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', variables('migrateProjectName'), 'Servers-Discovery-ServerDiscovery')]"
                    },
                    "serverMigrationSolutionId": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', variables('migrateProjectName'), 'Servers-Migration-ServerMigration')]"
                    },
                    "serverMigrationDataReplicationSolutionId": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', variables('migrateProjectName'), 'Servers-Migration-ServerMigration_DataReplication')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Migrate/MigrateProjects', variables('migrateProjectName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2022-09-01",
              "name": "deploy-migrate-artifacts",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "prefix": {
                    "value": "[parameters('prefix')]"
                  },
                  "migrateLocation": {
                    "value": "[parameters('migrateLocation')]"
                  },
                  "serverAssessmentSolutionId": {
                    "value": "[reference(resourceId('Microsoft.Resources/deployments', 'deploy-migrate-solutions'), '2022-09-01').outputs.serverAssessmentSolutionId.value]"
                  },
                  "serverDiscoverySolutionId": {
                    "value": "[reference(resourceId('Microsoft.Resources/deployments', 'deploy-migrate-solutions'), '2022-09-01').outputs.serverDiscoverySolutionId.value]"
                  },
                  "tags": {
                    "value": "[parameters('tags')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.18.4.5664",
                      "templateHash": "migrate-artifacts-template"
                    }
                  },
                  "parameters": {
                    "prefix": {
                      "type": "string",
                      "metadata": {
                        "description": "Resource name prefix"
                      }
                    },
                    "migrateLocation": {
                      "type": "string",
                      "metadata": {
                        "description": "Location for Azure Migrate resources"
                      }
                    },
                    "serverAssessmentSolutionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Server Assessment Solution ID"
                      }
                    },
                    "serverDiscoverySolutionId": {
                      "type": "string",
                      "metadata": {
                        "description": "Server Discovery Solution ID"
                      }
                    },
                    "tags": {
                      "type": "object",
                      "defaultValue": {},
                      "metadata": {
                        "description": "Tags to apply to the resources"
                      }
                    }
                  },
                  "variables": {
                    "location": "[parameters('migrateLocation')]",
                    "projectName": "[parameters('prefix')]",
                    "migrateProjectName": "[format('{0}-azm', parameters('prefix'))]",
                    "applianceName": "[format('{0}collector', parameters('prefix'))]",
                    "assessmentProjectName": "[concat(variables('projectName'), 'asmproject')]",
                    "vmwareSiteName": "[concat(variables('projectName'), 'vmwaresite')]",
                    "masterSiteName": "[concat(variables('projectName'), 'mastersite')]",
                    "sqlSiteName": "[concat(variables('projectName'), 'sqlsites')]",
                    "webAppSiteName": "[concat(variables('projectName'), 'webappsite')]",
                    "pgsqlSiteName": "[concat(variables('projectName'), 'pgsql')]",
                    "mysqlSiteName": "[concat(variables('projectName'), 'mysql')]"
                  },
                  "resources": [
                    {
                      "type": "Microsoft.OffAzure/VMwareSites",
                      "apiVersion": "2020-07-10",
                      "name": "[variables('vmwareSiteName')]",
                      "location": "[variables('location')]",
                      "tags": "[union(parameters('tags'), createObject('Migrate Project', variables('projectName')))]",
                      "kind": "Migrate",
                      "properties": {
                        "applianceName": "[variables('applianceName')]",
                        "servicePrincipalIdentityDetails": {
                          "tenantId": "tenantId",
                          "applicationId": "applicationId",
                          "objectId": "objectId",
                          "audience": "audience",
                          "aadAuthority": "aadAuthority"
                        },
                        "discoverySolutionId": "[parameters('serverDiscoverySolutionId')]"
                      }
                    },
                    {
                      "type": "Microsoft.Migrate/assessmentprojects",
                      "apiVersion": "2020-05-01-preview",
                      "name": "[variables('assessmentProjectName')]",
                      "location": "[variables('location')]",
                      "tags": "[union(parameters('tags'), createObject('Migrate Project', variables('projectName')))]",
                      "kind": "Migrate",
                      "properties": {
                        "projectStatus": "Active",
                        "assessmentSolutionId": "[parameters('serverAssessmentSolutionId')]",
                        "publicNetworkAccess": null,
                        "customerWorkspaceId": null,
                        "customerWorkspaceLocation": null,
                        "customerStorageAccountArmId": null
                      }
                    },
                    {
                      "type": "Microsoft.Migrate/assessmentprojects/vmwarecollectors",
                      "apiVersion": "2025-09-09-preview",
                      "name": "[concat(variables('assessmentProjectName'), '/', variables('vmwareSiteName'), 'vmwarecollector')]",
                      "location": "[variables('location')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]",
                        "[resourceId('Microsoft.Migrate/assessmentprojects', variables('assessmentProjectName'))]"
                      ],
                      "tags": "[union(parameters('tags'), createObject('Migrate Project', variables('projectName')))]",
                      "kind": "Migrate",
                      "properties": {
                        "agentProperties": {
                          "id": "[reference(resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName')), '2020-07-10').agentDetails.id]",
                          "spnDetails": {
                            "authority": "authority",
                            "applicationId": "appId",
                            "audience": "audience",
                            "objectId": "objectid",
                            "tenantId": "tenantid"
                          }
                        },
                        "discoverySiteId": "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]"
                      }
                    },
                    {
                      "type": "microsoft.applicationmigration/pgsqlsites",
                      "apiVersion": "2025-02-01-preview",
                      "name": "[variables('pgsqlSiteName')]",
                      "location": "[variables('location')]",
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "properties": {
                        "masterSiteId": "[resourceId('Microsoft.OffAzure/MasterSites', variables('masterSiteName'))]",
                        "migrateProjectId": "[resourceId('Microsoft.Migrate/MigrateProjects', variables('migrateProjectName'))]"
                      }
                    },
                    {
                      "type": "microsoft.mysqldiscovery/mysqlsites",
                      "apiVersion": "2024-12-30-preview",
                      "name": "[variables('mysqlSiteName')]",
                      "location": "[variables('location')]",
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "properties": {
                        "masterSiteId": "[resourceId('Microsoft.OffAzure/MasterSites', variables('masterSiteName'))]",
                        "migrateProjectId": "[resourceId('Microsoft.Migrate/MigrateProjects', variables('migrateProjectName'))]"
                      }
                    },
                    {
                      "type": "Microsoft.OffAzure/MasterSites",
                      "apiVersion": "2020-07-07",
                      "name": "[variables('masterSiteName')]",
                      "location": "[variables('location')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]",
                        "[resourceId('microsoft.applicationmigration/pgsqlsites', variables('pgsqlSiteName'))]",
                        "[resourceId('microsoft.mysqldiscovery/mysqlsites', variables('mysqlSiteName'))]"
                      ],
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "kind": "Migrate",
                      "properties": {
                        "allowMultipleSites": true,
                        "sites": [
                          "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]",
                          "[resourceId('microsoft.applicationmigration/pgsqlsites', variables('pgsqlSiteName'))]",
                          "[resourceId('microsoft.mysqldiscovery/mysqlsites', variables('mysqlSiteName'))]"
                        ]
                      }
                    },
                    {
                      "type": "microsoft.offazure/mastersites/sqlsites",
                      "apiVersion": "2022-10-27",
                      "name": "[concat(variables('masterSiteName'), '/', variables('sqlSiteName'))]",
                      "location": "[variables('location')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/MasterSites', variables('masterSiteName'))]"
                      ],
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "kind": "Migrate",
                      "properties": {
                        "discoverySolutionId": "[parameters('serverDiscoverySolutionId')]",
                        "siteAppliancePropertiesCollection": [
                          {
                            "servicePrincipalIdentityDetails": {
                              "tenantId": "tenantId",
                              "applicationId": "applicationId",
                              "objectId": "objectId",
                              "audience": "audience",
                              "aadAuthority": "aadAuthority"
                            },
                            "applianceName": "[variables('applianceName')]"
                          }
                        ]
                      }
                    },
                    {
                      "type": "Microsoft.OffAzure/MasterSites/WebAppSites",
                      "apiVersion": "2020-11-11-preview",
                      "name": "[concat(variables('masterSiteName'), '/', variables('webAppSiteName'))]",
                      "location": "[variables('location')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/MasterSites', variables('masterSiteName'))]"
                      ],
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "kind": "Migrate",
                      "properties": {
                        "discoverySolutionId": "[parameters('serverDiscoverySolutionId')]",
                        "siteAppliancePropertiesCollection": [
                          {
                            "servicePrincipalIdentityDetails": {
                              "tenantId": "tenantId",
                              "applicationId": "applicationId",
                              "objectId": "objectId",
                              "audience": "audience",
                              "aadAuthority": "aadAuthority"
                            },
                            "applianceName": "[variables('applianceName')]"
                          }
                        ]
                      }
                    },
                    {
                      "type": "microsoft.offazure/mastersites/sqlsites/discoverysitedatasources",
                      "apiVersion": "2020-11-11-preview",
                      "name": "[concat(variables('masterSiteName'), '/', variables('sqlSiteName'), '/vmwarediscoverysource')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]",
                        "[resourceId('microsoft.offazure/mastersites/sqlsites', variables('masterSiteName'), variables('sqlSiteName'))]"
                      ],
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "properties": {
                        "discoverySiteId": "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]"
                      }
                    },
                    {
                      "type": "microsoft.offazure/mastersites/webappsites/discoverysitedatasources",
                      "apiVersion": "2020-11-11-preview",
                      "name": "[concat(variables('masterSiteName'), '/', variables('webAppSiteName'), '/vmwarediscoverysource')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]",
                        "[resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', variables('masterSiteName'), variables('webAppSiteName'))]"
                      ],
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "properties": {
                        "discoverySiteId": "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]"
                      }
                    },
                    {
                      "type": "microsoft.migrate/assessmentprojects/sqlcollectors",
                      "apiVersion": "2023-03-15",
                      "name": "[concat(variables('assessmentProjectName'), '/', variables('sqlSiteName'), 'collector')]",
                      "dependsOn": [
                        "[resourceId('microsoft.offazure/mastersites/sqlsites', variables('masterSiteName'), variables('sqlSiteName'))]",
                        "[resourceId('Microsoft.Migrate/assessmentprojects', variables('assessmentProjectName'))]"
                      ],
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "kind": "Migrate",
                      "properties": {
                        "agentProperties": {
                          "id": "[reference(resourceId('microsoft.offazure/mastersites/sqlsites', variables('masterSiteName'), variables('sqlSiteName')), '2023-06-06').siteAppliancePropertiesCollection[0].agentDetails.id]",
                          "spnDetails": {
                            "authority": "authority",
                            "applicationId": "appId",
                            "audience": "audience",
                            "objectId": "objectid",
                            "tenantId": "tenantid"
                          }
                        },
                        "discoverySiteId": "[resourceId('microsoft.offazure/mastersites/sqlsites', variables('masterSiteName'), variables('sqlSiteName'))]"
                      }
                    },
                    {
                      "type": "Microsoft.Migrate/assessmentprojects/webappcollectors",
                      "apiVersion": "2023-03-15",
                      "name": "[concat(variables('assessmentProjectName'), '/', variables('webAppSiteName'), 'collector')]",
                      "location": "[variables('location')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', variables('masterSiteName'), variables('webAppSiteName'))]",
                        "[resourceId('Microsoft.Migrate/assessmentprojects', variables('assessmentProjectName'))]",
                        "[resourceId('microsoft.offazure/mastersites/webappsites/discoverysitedatasources', variables('masterSiteName'), variables('webAppSiteName'), 'vmwarediscoverysource')]"
                      ],
                      "tags": {
                        "Migrate Project": "[variables('projectName')]"
                      },
                      "kind": "Migrate",
                      "properties": {
                        "agentProperties": {
                          "id": "[reference(resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', variables('masterSiteName'), variables('webAppSiteName')), '2023-06-06').siteAppliancePropertiesCollection[0].agentDetails.id]",
                          "spnDetails": {
                            "authority": "authority",
                            "applicationId": "appId",
                            "audience": "audience",
                            "objectId": "objectid",
                            "tenantId": "tenantid"
                          }
                        },
                        "discoverySiteId": "[resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', variables('masterSiteName'), variables('webAppSiteName'))]"
                      }
                    },
                    {
                      "type": "Microsoft.Migrate/MigrateProjects/Solutions",
                      "apiVersion": "2020-06-01-preview",
                      "name": "[concat(variables('migrateProjectName'), '/Servers-Discovery-ServerDiscovery')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.OffAzure/MasterSites', variables('masterSiteName'))]",
                        "[resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName'))]",
                        "[resourceId('Microsoft.OffAzure/MasterSites/SqlSites', variables('masterSiteName'), variables('sqlSiteName'))]",
                        "[resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', variables('masterSiteName'), variables('webAppSiteName'))]"
                      ],
                      "properties": {
                        "tool": "ServerDiscovery",
                        "purpose": "Discovery",
                        "goal": "Servers",
                        "status": "Inactive",
                        "cleanupState": "None",
                        "summary": {
                          "instanceType": "Servers",
                          "discoveredCount": 0,
                          "assessedCount": 0,
                          "replicatingCount": 0,
                          "testMigratedCount": 0,
                          "migratedCount": 0
                        },
                        "details": {
                          "groupCount": 0,
                          "assessmentCount": 0,
                          "extendedDetails": {
                            "masterSiteId": "[resourceId('Microsoft.OffAzure/MasterSites', variables('masterSiteName'))]",
                            "applianceNameToSiteIdMapV3": "[concat('[{\"', variables('applianceName'), '\":{\"ApplianceName\":\"', variables('applianceName'), '\",\"SiteId\":\"', resourceId('Microsoft.OffAzure/VMwareSites', variables('vmwareSiteName')), '\",\"ApplianceDetails\":{\"isRegistered\":\"true\"}}}]')]",
                            "supportedScenarioSites": "[concat('{ \"SqlSites\": \"', resourceId('Microsoft.OffAzure/MasterSites/SqlSites', variables('masterSiteName'), variables('sqlSiteName')), '\", \"WebAppSites\": \"', resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', variables('masterSiteName'), variables('webAppSiteName')), '\" }')]"
                          }
                        }
                      }
                    },
                    {
                      "type": "Microsoft.Migrate/MigrateProjects/Solutions",
                      "apiVersion": "2020-06-01-preview",
                      "name": "[concat(variables('migrateProjectName'), '/Servers-Assessment-ServerAssessment')]",
                      "dependsOn": [
                        "[resourceId('Microsoft.Migrate/assessmentprojects', variables('assessmentProjectName'))]"
                      ],
                      "properties": {
                        "cleanupState": "None",
                        "details": {
                          "groupCount": 0,
                          "assessmentCount": 0,
                          "extendedDetails": {
                            "projectId": "[resourceId('Microsoft.Migrate/assessmentprojects', variables('assessmentProjectName'))]"
                          }
                        },
                        "goal": "Servers",
                        "purpose": "Assessment",
                        "status": "Active",
                        "summary": {
                          "instanceType": "Servers",
                          "discoveredCount": 0,
                          "assessedCount": 0,
                          "replicatingCount": 0,
                          "testMigratedCount": 0,
                          "migratedCount": 0
                        },
                        "tool": "ServerAssessment"
                      }
                    }
                  ]                  
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Migrate/MigrateProjects', variables('migrateProjectName'))]",
                "[resourceId('Microsoft.Resources/deployments', 'deploy-migrate-solutions')]"
              ]
            }
          ]
        }
      }
    }
  ]

}
