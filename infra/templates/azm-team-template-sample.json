{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "location": {
            "defaultValue": "eastus2euap",
            "type": "String"
        },
        "projectName": {
            "defaultValue": "disconnected26",
            "type": "String"
        }
    },
    "variables": {
        "applianceName": "offlinecollector"
    },
    "resources": [
        {
            "type": "Microsoft.OffAzure/VMwareSites",
            "apiVersion": "2020-07-10",
            "name": "[concat(parameters('projectName'), 'vmwaresite')]",
            "location": "[parameters('location')]",
            "dependsOn": [],
            "tags": {
                "Migrate Project": "[parameters('projectName')]"
            },
            "kind": "Migrate",
            "properties": {
                "applianceName": "[variables('applianceName')]",
                "servicePrincipalIdentityDetails": {
                    "tenantId": "tenantId",
                    "applicationId": "applicationId",
                    "objectId": "objectId",
                    "audience": "audience",
                    "aadAuthority": "aadAuthority"
                },
                "discoverySolutionId": "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', parameters('projectName'), 'Servers-Discovery-ServerDiscovery')]"
            }
        },
        {
            "type": "Microsoft.Migrate/assessmentprojects",
            "apiVersion": "2020-05-01-preview",
            "name": "[concat(parameters('projectName'), 'asmproject')]",
            "location": "[parameters('location')]",
            "tags": {
                "Migrate Project": "[parameters('projectName')]"
            },
            "kind": "Migrate",
            "properties": {
                "projectStatus": "Active",
                "assessmentSolutionId": "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', parameters('projectName'), 'Servers-Assessment-ServerAssessment')]"
            }
        },
        {
            "type": "Microsoft.Migrate/assessmentprojects/vmwarecollectors",
            "apiVersion": "2025-09-09-preview",
            "name": "[concat(parameters('projectName'), 'asmproject', '/', parameters('projectName'), 'asmprojectvmwarecollector')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Migrate/assessmentprojects', concat(parameters('projectName'), 'asmproject'))]",
                "[resourceId('Microsoft.OffAzure/VMwareSites', concat(parameters('projectName'), 'vmwaresite'))]"
            ],
            "tags": {
                "Migrate Project": "[parameters('projectName')]"
            },
            "kind": "Migrate",
            "properties": {
                "agentProperties": {
                    "id": "[reference(resourceId('Microsoft.OffAzure/VMwareSites', concat(parameters('projectName'), 'vmwaresite')), '2020-07-10').agentDetails.id]",
                    "spnDetails": {
                        "authority": "authority",
                        "applicationId": "appId",
                        "audience": "audience",
                        "objectId": "objectid",
                        "tenantId": "tenantid"
                    }
                },
                "discoverySiteId": "[resourceId('Microsoft.OffAzure/VMwareSites', concat(parameters('projectName'), 'vmwaresite'))]"
            }
        },
        {
            "type": "Microsoft.OffAzure/MasterSites",
            "apiVersion": "2020-07-07",
            "name": "[concat(parameters('projectName'), 'mastersite')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.OffAzure/VMwareSites', concat(parameters('projectName'), 'vmwaresite'))]"
            ],
            "tags": {
                "Migrate Project": "[parameters('projectName')]"
            },
            "kind": "Migrate",
            "properties": {
                "sites": [
                    "[resourceId('Microsoft.OffAzure/VMwareSites', concat(parameters('projectName'), 'vmwaresite'))]"
                ],
                "allowMultipleSites": true
            }
        },
        {
            "type": "Microsoft.OffAzure/MasterSites/WebAppSites",
            "apiVersion": "2020-11-11-preview",
            "name": "[concat(parameters('projectName'), 'mastersite/', parameters('projectName'), 'webappsite')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.OffAzure/MasterSites', concat(parameters('projectName'), 'mastersite'))]"
            ],
            "tags": {
                "Migrate Project": "[parameters('projectName')]"
            },
            "kind": "Migrate",
            "properties": {
                "discoverySolutionId": "[resourceId('Microsoft.Migrate/MigrateProjects/Solutions', parameters('projectName'), 'Servers-Discovery-ServerDiscovery')]",
                "siteAppliancePropertiesCollection": [
                    {
                        "servicePrincipalIdentityDetails": {
                            "tenantId": "tenantId",
                            "applicationId": "applicationId",
                            "objectId": "objectId",
                            "audience": "audience",
                            "aadAuthority": "aadAuthority"
                        },
                        "applianceName": "[variables('applianceName')]"
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Migrate/assessmentprojects/webappcollectors",
            "apiVersion": "2020-05-01-preview",
            "name": "[concat(parameters('projectName'), 'asmproject', '/', parameters('projectName'), 'asmprojectwebappcollector')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[resourceId('Microsoft.Migrate/assessmentprojects', concat(parameters('projectName'), 'asmproject'))]",
                "[resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', concat(parameters('projectName'), 'mastersite'), concat(parameters('projectName'), 'webappsite'))]"
            ],
            "tags": {
                "Migrate Project": "[parameters('projectName')]"
            },
            "kind": "Migrate",
            "properties": {
                "agentProperties": {
                    "agentId": "[reference(resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', concat(parameters('projectName'), 'mastersite'), concat(parameters('projectName'), 'webappsite')), '2023-06-06').siteAppliancePropertiesCollection[0].agentDetails.id]",
                    "spnDetails": {
                        "authority": "authority",
                        "applicationId": "appId",
                        "audience": "audience",
                        "objectId": "objectid",
                        "tenantId": "tenantid"
                    }
                },
                "discoverySiteId": "[resourceId('Microsoft.OffAzure/MasterSites/WebAppSites', concat(parameters('projectName'), 'mastersite'), concat(parameters('projectName'), 'webappsite'))]"
            }
        }
    ]
}